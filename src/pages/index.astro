---
import { getCollection } from "astro:content";
import SocialMediaIcons from "../components/SocialMediaIcons.astro";
import MatrixBackground from "../components/MatrixBackground.astro";
import ProjectItem from "../components/ProjectItem.astro";
import Card from "../components/ui/Card.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import { sortMDByDate } from "../utils";
import TerminalHeader from "../components/ui/TerminalHeader.astro";
import TerminalPrompt from "../components/ui/TerminalPrompt.astro";
import InfoRow from "../components/ui/InfoRow.astro";
import ExternalLink from "../components/ui/ExternalLink.astro";
import SectionHeading from "../components/ui/SectionHeading.astro";
import Divider from "../components/ui/Divider.astro";
import PostList from "../components/ui/PostList.astro";

const MAX_POSTS = 10;
const allPosts = await getCollection("blog");
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS);

const techStack: Record<string, string> = {
  js: "JavaScript",
  ts: "TypeScript",
  "node.js": "Node",
  astro: "This site is built on astro",
  python: "Python",
  sql: "SQL",
  "claude-code": "Best tool ever",
  "next.js": "Next.js",
  aws: "AWS",
  gcp: "GCP",
  docker: "Docker",
  tf: "Terraform",
};

const projects: Array<{
  title: string;
  description: string;
  link: string;
  icon: string;
}> = [
  {
    title: "terminus",
    description: "a minimalist astro template for developers",
    link: "https://github.com/ojoanalogo/terminus-astro-template",
    icon: "üíª",
  },
  {
    title: "Another Project",
    description: "Add your own projects here",
    icon: "üíª",
    link: "",
  },
];
---

<BaseLayout navbarActiveItemID="home">
  <MatrixBackground
    slot="background"
    highlightColor="rgba(222, 133, 74, 0.2)"
    boxSize={40}
    movementSpeed={0.1}
    movementDirection="up-left"
  />
  <main>
    <section id="about" aria-labelledby="about-heading">
      <Card role="region">
        <TerminalHeader title="terminal - ssh guest@terminus" />

        <!-- Content -->
        <div class="text-xs">
          <div class="space-y-4 sm:space-y-2">
            <div class="flex items-center gap-3 mb-4">
              <div class="flex flex-col gap-1">
                <h1 class="text-2xl">
                  ü™¥ hello <span class="text-primary font-medium">visitor</span>
                </h1>
                <p class="text-muted text-xs">
                  this is terminus, an astro template
                </p>
              </div>
            </div>

            <!-- Personal paragraph -->
            <div class="bg-gray-200/50 dark:bg-gray-500/10 rounded-lg p-3 mb-4">
              <p class="text-primary leading-relaxed">
                you're supossed to write something interesting here, but is up
                to you
              </p>
            </div>

            <Divider class="mb-2" />

            <InfoRow label="location">the internet üõú</InfoRow>

            <InfoRow label="main hobby"> vibecoding </InfoRow>

            <InfoRow label="current project">
              <ExternalLink
                href="https://google.com"
                label="Visit Google, an evil company"
              >
                world domination
              </ExternalLink>
            </InfoRow>

            <InfoRow label="main interests">
              science, coding, claude, startups
            </InfoRow>

            <InfoRow label="contact">
              <a
                class="text-accent hover:underline focus:outline-none"
                href="mailto:hello@youremail.com"
                aria-label="Send email to site author">hello@youremail.com</a
              >
            </InfoRow>

            <InfoRow label="social">
              <SocialMediaIcons />
            </InfoRow>

            <div class="pt-2">
              <div class="flex flex-col sm:flex-row gap-0.5 sm:gap-0">
                <span class="text-muted sm:w-36 shrink-0">tech stack</span>
                <div
                  class="flex flex-wrap gap-2"
                  role="list"
                  aria-label="Tech stack"
                >
                  {
                    Object.keys(techStack).map((lang) => (
                      <span
                        class="text-secondary hover:text-accent transition-colors"
                        title={techStack[lang]}
                      >
                        {lang}
                      </span>
                    ))
                  }
                </div>
              </div>
            </div>
          </div>
        </div>

        <TerminalPrompt command="cat about.txt" />
      </Card>
    </section>

    <section id="projects" class="mt-2">
      <Card class="text-secondary" role="region" aria-label="Project showcase">
        <SectionHeading>üíª your projects</SectionHeading>
        <div class="space-y-2" role="list">
          {
            projects.map((project, index) => (
              <ProjectItem
                title={project.title}
                description={project.description}
                link={project.link}
                icon={project.icon}
                index={index}
              />
            ))
          }
        </div>
        <TerminalPrompt
          command={`ls -la projects/ | total ${projects.length}`}
        />
      </Card>
    </section>

    {
      allPosts.length > 0 && (
        <section id="blog" class="mt-2">
          <Card>
            <SectionHeading>‚úçÔ∏è latest posts</SectionHeading>
            <PostList posts={allPostsByDate} />
            <TerminalPrompt
              command={`tail -n ${allPostsByDate.length} blog/`}
            />
          </Card>
        </section>
      )
    }
  </main>
</BaseLayout>
